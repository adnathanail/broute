use crate::{rocket, ShortestPathResponse};
use rocket::http::Status;
use rocket::local::asynchronous::Client;

#[async_test]
async fn test_shortest_path_api() {
    let client = Client::tracked(rocket().await.unwrap())
        .await
        .expect("valid rocket instance");
    let response = client
        .get("/shortest_path/51.524415/-0.134700/51.520777/-0.134575/")
        .dispatch()
        .await;
    assert_eq!(response.status(), Status::Ok);
    assert_eq!(
        response.into_json::<ShortestPathResponse>().await.unwrap(),
        ShortestPathResponse {
            from_point: (51.5243837, -0.13468290000000002),
            to_point: (51.520805900000006, -0.1346516),
            path: vec![
                (51.5243837, -0.13468290000000002),
                (51.524368800000005, -0.13466630000000002),
                (51.52434, -0.1347254),
                (51.5243308, -0.1347443),
                (51.5242542, -0.13465770000000002),
                (51.523980300000005, -0.1343703),
                (51.523973600000005, -0.13436320000000002),
                (51.523961500000006, -0.1343619),
                (51.523945600000005, -0.13438270000000002),
                (51.5239185, -0.1343544),
                (51.5239022, -0.134387),
                (51.5238834, -0.1344364),
                (51.523583900000006, -0.13517800000000002),
                (51.523551700000006, -0.1352867),
                (51.5235185, -0.1353687),
                (51.5233873, -0.1356986),
                (51.5230594, -0.1365231),
                (51.523022700000006, -0.1364889),
                (51.5229849, -0.1364921),
                (51.5226903, -0.13622710000000002),
                (51.5223596, -0.1359078),
                (51.5223395, -0.13588640000000002),
                (51.52230470000001, -0.13596760000000002),
                (51.522245600000005, -0.1359084),
                (51.5221424, -0.1357997),
                (51.522124600000005, -0.1357852),
                (51.522099, -0.1357612),
                (51.521975000000005, -0.13564330000000002),
                (51.5217895, -0.1354677),
                (51.5216708, -0.1353572),
                (51.5216052, -0.1353),
                (51.521565200000005, -0.1352645),
                (51.521527600000006, -0.13523100000000002),
                (51.5214616, -0.1351723),
                (51.521379800000005, -0.1350996),
                (51.5213408, -0.13506490000000002),
                (51.5213029, -0.13503120000000002),
                (51.5211655, -0.1348965),
                (51.5211042, -0.1348374),
                (51.5209332, -0.1346672),
                (51.5208359, -0.1345667),
                (51.520805900000006, -0.1346516),
            ],
            path_length: 0.5373216843627054,
        }
    );
}
